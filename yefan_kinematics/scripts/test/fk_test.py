import unittest
import numpy.testing
from yefan_kinematics.scripts.fk import calculate

IFK_CASES = [
    [[0, 0, 0, 0, 0, 0], [[1, 0, 0, 1807],
                          [0, 1, 0, 0],
                          [0, 0, 1, 1970],
                          [0, 0, 0, 1]]
     ],
    [[0.5, 0.5, 0.5, 0.5, 0.5, 0.5], [[6.5995575e-01, -7.0813223e-02, -7.4795983e-01, 1.9912926e+03],
                                      [6.2244683e-01, 6.0904827e-01, 4.9154872e-01, 1.1441590e+03],
                                      [4.2073549e-01, -7.8996562e-01, 4.4602237e-01, 1.9288594e+03],
                                      [0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 1.0000000e+00]]
     ],
    [[0.5, 0.5, 0.5, 0.5, 0.5, -0.5], [[6.5995575e-01, -6.6764704e-01, -3.4453715e-01, 1.9912926e+03],
                                       [6.2244683e-01, 7.4269417e-01, -2.4691155e-01, 1.1441590e+03],
                                       [4.2073549e-01, -5.1505361e-02, 9.0572007e-01, 1.9288594e+03],
                                       [0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 1.0000000e+00]]
     ],
    [[0.5, 0.5, 0.5, 0.5, -0.5, 0.5], [[8.8034656e-01, -4.7423590e-01, -9.4995633e-03, 2.0386766e+03],
                                       [2.1902415e-01, 3.8865746e-01, 8.9497140e-01, 1.0574232e+03],
                                       [-4.2073549e-01, -7.8996562e-01, 4.4602237e-01, 1.7479431e+03],
                                       [0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 1.0000000e+00]]
     ],
    [[0.5, 0.5, 0.5, 0.5, -0.5, -0.5], [[8.8034656e-01, -2.6422436e-01, 3.9392312e-01, 2.0386766e+03],
                                        [2.1902415e-01, 9.6308498e-01, 1.5651113e-01, 1.0574232e+03],
                                        [-4.2073549e-01, -5.1505361e-02, 9.0572007e-01, 1.7479431e+03],
                                        [0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 1.0000000e+00]]
     ],
    [[0.5, 0.5, 0.5, -0.5, 0.5, 0.5], [[8.8034656e-01, -2.6422436e-01, -3.9392312e-01, 2.0386766e+03],
                                       [2.1902415e-01, 9.6308498e-01, -1.5651113e-01, 1.0574232e+03],
                                       [4.2073549e-01, 5.1505361e-02, 9.0572007e-01, 1.9288594e+03],
                                       [0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 1.0000000e+00]]
     ],
    [[0.5, 0.5, 0.5, -0.5, 0.5, -0.5], [[8.8034656e-01, -4.7423590e-01, 9.4995633e-03, 2.0386766e+03],
                                        [2.1902415e-01, 3.8865746e-01, -8.9497140e-01, 1.0574232e+03],
                                        [4.2073549e-01, 7.8996562e-01, 4.4602237e-01, 1.9288594e+03],
                                        [0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 1.0000000e+00]]
    ],
    [[0.5, 0.5, 0.5, -0.5, -0.5, 0.5], [[6.5995575e-01, -6.6764704e-01, 3.4453715e-01, 1.9912926e+03],
                                        [6.2244683e-01, 7.4269417e-01, 2.4691155e-01, 1.1441590e+03],
                                        [-4.2073549e-01, 5.1505361e-02, 9.0572007e-01, 1.7479431e+03],
                                        [0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 1.0000000e+00]]
     ],
    [[0.5, 0.5, 0.5, -0.5, -0.5, -0.5], [[6.5995575e-01, -7.0813223e-02, 7.4795983e-01, 1.9912926e+03],
                                         [6.2244683e-01, 6.0904827e-01, -4.9154872e-01, 1.1441590e+03],
                                         [-4.2073549e-01, 7.8996562e-01, 4.4602237e-01, 1.7479431e+03],
                                         [0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 1.0000000e+00]]
     ]

]


class TestFK(unittest.TestCase):
    def test_fk(self):
        for i in range(len(IFK_CASES)):
            c = IFK_CASES[i]
            numpy.testing.assert_almost_equal(c[1], calculate(c[0]), decimal=4, err_msg="case failed: " + str(i))
            #
            # def test_positions_failed(self):
            #     with self.assertRaises(KeyError) as ctx:
            #         init_js_wrapper().position('joint3')
            #     self.assertIn("not found in names", str(ctx.exception))


if __name__ == '__main__':
    unittest.main()
